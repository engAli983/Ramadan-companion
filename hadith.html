<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±ÙÙŠÙ‚ Ø±Ù…Ø¶Ø§Ù† | Ø­Ø¯ÙŠØ« Ø§Ù„ÙŠÙˆÙ…</title>
    <link rel="manifest" href="manifest.json?v=2">
    <meta name="theme-color" content="#0f766e">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .hadith-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 99px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        .badge-fasting { background: #e0f2fe; color: #0284c7; } /* Sky Blue */
        .badge-morals { background: #fce7f3; color: #db2777; } /* Pink */
        .badge-intention { background: #fef9c3; color: #ca8a04; } /* Yellow/Gold */
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <main class="container">
        <header class="text-center mt-4 mb-4">
            <button id="theme-toggle" aria-label="Toggle Theme">ğŸŒ™</button>
            <h1>Ù…Ù† Ù…Ø´ÙƒØ§Ø© Ø§Ù„Ù†Ø¨ÙˆØ©</h1>
            <p class="text-muted">Ù‡Ø¯Ø§ÙŠØ© Ù„Ù‚Ù„Ø¨Ùƒ</p>
        </header>

        <section id="category-tabs" class="mb-4 text-center">
            <div style="display: inline-flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center;">
                <button class="btn btn-secondary cat-btn active" onclick="selectCategory('fasting')" id="btn-fasting">ğŸ•Œ Ø§Ù„ØµÙŠØ§Ù…</button>
                <button class="btn btn-secondary cat-btn" onclick="selectCategory('morals')" id="btn-morals">ğŸ¤ Ø£Ø®Ù„Ø§Ù‚</button>
                <button class="btn btn-secondary cat-btn" onclick="selectCategory('intention')" id="btn-intention">ğŸ’« Ø§Ù„Ù†ÙŠØ©</button>
                <button class="btn btn-secondary cat-btn" onclick="selectCategory('dua')" id="btn-dua">ğŸ¤² Ø§Ù„Ø¯Ø¹Ø§Ø¡</button>
            </div>
            <style>
                .cat-btn.active {
                    background-color: var(--color-primary);
                    color: white;
                    border-color: var(--color-primary);
                }
            </style>
        </section>

        <section id="hadith-display-area">
            <!-- Dynamic Single Card -->
            <div class="card hadith-card text-center fade-in" id="current-hadith-card">
                <div id="hadith-badge-container"></div>
                
                <h2 class="quran-text" style="font-size: 1.4rem; line-height: 1.8; margin: 1rem 0;" id="hadith-text">
                    Ø§Ø®ØªØ± Ù‚Ø³Ù…Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ«
                </h2>

                <div class="mt-4 text-start" style="text-align: right; background: #f8fafc; padding: 1rem; border-radius: 8px; border: 1px dashed #cbd5e1;">
                    <p class="mb-2" style="color: #475569;">
                        <strong>ğŸ“– Ø§Ù„Ø´Ø±Ø­ Ø§Ù„Ù…Ø¨Ø³Ø·:</strong> <span id="hadith-explanation">...</span>
                    </p>
                    <p style="color: var(--color-primary);">
                        <strong>ğŸš€ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ÙŠ:</strong> <span id="hadith-benefit">...</span>
                    </p>
                </div>

                <div class="mt-4" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" style="flex: 2;" onclick="nextHadithInCurrentCategory()">
                        ğŸ” Ø­Ø¯ÙŠØ« Ø¢Ø®Ø±
                    </button>
                    <button class="btn btn-secondary" style="flex: 1;" onclick="copyCurrentHadith()">
                        ğŸ“‹ Ù†Ø³Ø®
                    </button>
                </div>
            </div>
        </section>

        <div style="height: 100px;"></div>
    </main>

    <!-- Navigation -->
    <nav class="nav-bottom">
        <a href="index.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" /></svg>
            <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </a>
        <a href="quran_audio.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z" />
            </svg>
            <span>ØªÙ„Ø§ÙˆØ§Øª</span>
        </a>
        <a href="wird.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>
            <span>Ø§Ù„ÙˆØ±Ø¯</span>
        </a>
        <a href="hadith.html" class="nav-item active">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" /></svg>
            <span>Ø­Ø¯ÙŠØ«</span>
        </a>
        <a href="stories.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
            </svg>
            <span>Ù‚ØµØµ</span>
        </a>
        <a href="qa.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" /></svg>
            <span>ÙØªØ§ÙˆÙ‰</span>
        </a>
        <a href="zakat.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <span>Ø²ÙƒØ§Ø©</span>
        </a>
    </nav>

    <script src="js/storage.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('Service Worker registered:', registration);
                    })
                    .catch((error) => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
        
        let hadithData = {};
        let currentCategory = 'fasting'; // Default

        document.addEventListener('DOMContentLoaded', async () => {
            hadithData = await App.fetchData('hadith.json');
            // Init with default category. Check if data loaded correctly.
            if(hadithData) selectCategory('fasting');
        });

        function selectCategory(cat) {
            // Safety check
            if(!hadithData || (Array.isArray(hadithData) && hadithData.length === 0)) return;
            
            currentCategory = cat;
            
            // Update UI Buttons
            document.querySelectorAll('.cat-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.getElementById(`btn-${cat}`);
            if(activeBtn) activeBtn.classList.add('active');

            // Render first item from category
            nextHadithInCurrentCategory();
        }

        let currentHadithId = null;

        function nextHadithInCurrentCategory() {
            // Handle both structure types if necessary, but expecting object now.
            let categoryHadiths = [];
            
            if (Array.isArray(hadithData)) {
                // Fallback for old flat structure if data not updated yet
                categoryHadiths = hadithData.filter(h => h.category === currentCategory);
            } else {
                // New Object structure
                categoryHadiths = hadithData[currentCategory] || [];
            }
            
            if (categoryHadiths.length === 0) {
                document.getElementById('hadith-text').textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø­Ø§Ø¯ÙŠØ« ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.";
                return;
            }

            // Optimization: If only 1 item, just show it
            if (categoryHadiths.length === 1) {
                const item = categoryHadiths[0];
                if(!item.category) item.category = currentCategory;
                renderHadith(item);
                return;
            }

            // Retry until we get a different one
            let random;
            let attempts = 0;
            do {
                random = categoryHadiths[Math.floor(Math.random() * categoryHadiths.length)];
                attempts++;
            } while (random.id === currentHadithId && attempts < 10);

            // Inject category explicitly if not present in item
            if(!random.category) random.category = currentCategory;
            renderHadith(random);
        }

        function renderHadith(hadith) {
            currentHadithId = hadith.id;
            const card = document.getElementById('current-hadith-card');
            
            document.getElementById('hadith-text').innerHTML = `"${hadith.text}"`;
            document.getElementById('hadith-explanation').textContent = hadith.explanation;
            document.getElementById('hadith-benefit').textContent = hadith.benefit;
            
            const badgeContainer = document.getElementById('hadith-badge-container');
            const catName = getCategoryName(hadith.category);
            const badgeClass = getCategoryClass(hadith.category);
            badgeContainer.innerHTML = `<span class="hadith-badge ${badgeClass}">${catName}</span>`;
            
            // Animation
            card.classList.remove('fade-in');
            void card.offsetWidth; 
            card.classList.add('fade-in');
        }

        function copyCurrentHadith() {
            const text = document.getElementById('hadith-text').textContent;
            navigator.clipboard.writeText(text).then(() => App.showNotification('ØªÙ… Ø§Ù„Ù†Ø³Ø®'));
        }

        function getCategoryName(cat) {
            const map = {
                'fasting': 'ğŸ•Œ Ø§Ù„ØµÙŠØ§Ù…',
                'morals': 'ğŸ¤ Ø£Ø®Ù„Ø§Ù‚',
                'intention': 'ğŸ’« Ø§Ù„Ù†ÙŠØ©',
                'dua': 'ğŸ¤² Ø§Ù„Ø¯Ø¹Ø§Ø¡'
            };
            return map[cat] || cat;
        }

        function getCategoryClass(cat) {
            const map = {
                'fasting': 'badge-fasting',
                'morals': 'badge-morals',
                'intention': 'badge-intention',
                'dua': 'badge-fasting' // Reusing style or add new one
            };
            return map[cat] || '';
        }
    </script>
</body>
</html>
