<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ุฑููู ุฑูุถุงู | ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</title>
    <link rel="manifest" href="manifest.json?v=2">
    <meta name="theme-color" content="#0f766e">
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <main class="container">
      <!-- Header -->
      <header class="text-center mt-4 mb-4">
        <button id="theme-toggle" aria-label="Toggle Theme">๐</button>
        <button id="notify-test-btn" aria-label="Test Notifications" style="border: none; background: none; font-size: 1.5rem; cursor: pointer;">๐</button>
        <h1>ุฑููู ุฑูุถุงู</h1>
        <p class="text-muted">ุฑูููู ุงููููู ููุนุจุงุฏุฉ ูุงูุตูุงุก</p>
        <div class="d-flex justify-content-center gap-2 mt-2">
          <a
            href="quran_audio.html"
            class="btn btn-primary btn-sm"
            style="border-radius: 99px; font-size: 0.8rem"
          >
            ๐ง ุงููุฑุขู ุงููุฑูู
          </a>
          <a
            href="videos.html"
            class="btn btn-secondary btn-sm"
            style="border-radius: 99px; font-size: 0.8rem"
          >
            ๐บ ูุฑุฆูุงุช ูููุงุนุธ
          </a>
          <a
            href="stories.html"
            class="btn btn-secondary btn-sm"
            style="border-radius: 99px; font-size: 0.8rem"
          >
            ๐ ูุตุต ูุนุจุฑ
          </a>
        </div>
      </header>

      <!-- Calendar & Countdown -->
      <section class="card text-center calendar-widget" id="calendar-widget">
          <div class="date-row">
              <span id="date-hijri">...</span>
              <span class="date-separator"></span>
              <span id="date-gregorian">...</span>
          </div>
          <div class="calendar-divider"></div>
          <p id="ramadan-counter" class="counter-text">
              ุฌุงุฑู ุงูุญุณุงุจ...
          </p>
      </section>

      <!-- Prayer Times Widget -->
      <section class="card text-center" id="prayer-widget">
          <div class="prayer-header mb-4">
              <p class="text-muted mb-0">ุงูุตูุงุฉ ุงููุงุฏูุฉ</p>
              <h2 id="next-prayer-name" class="quran-text text-primary">...</h2>
              <div id="countdown-timer" class="countdown-box">
                  00:00:00
              </div>
          </div>
          
          <div class="prayers-list" id="prayers-list">
              <!-- Injected via JS -->
              <div class="prayer-row"><span>ุงููุฌุฑ</span><span>...</span></div>
              <div class="prayer-row"><span>ุงูุธูุฑ</span><span>...</span></div>
              <div class="prayer-row"><span>ุงูุนุตุฑ</span><span>...</span></div>
              <div class="prayer-row"><span>ุงููุบุฑุจ</span><span>...</span></div>
              <div class="prayer-row"><span>ุงูุนุดุงุก</span><span>...</span></div>
          </div>
          
          <p class="text-muted mt-3" style="font-size: 0.8rem;">
              ๐ ุงููุงูุฑุฉ (ุชูููุช ูุตุฑ ุงูุนุงู)
          </p>
      </section>

      <!-- Ayah of the Day -->
      <section class="card ayah-card" id="ayah-container">
        <h2 style="font-size: 1rem; opacity: 0.8; margin-bottom: 0.5rem">
          ุขูุฉ ุงูููู
        </h2>
        <p class="ayah-text quran-text" id="ayah-text">ุฌุงุฑู ุงูุชุญููู...</p>
        <div class="ayah-meta" id="ayah-meta"></div>
        <div class="mt-4">
          <button
            class="btn btn-primary"
            style="
              background: rgba(255, 255, 255, 0.2);
              border: 1px solid rgba(255, 255, 255, 0.4);
            "
            onclick="copyAyah()"
          >
            ูุณุฎ ุงูุขูุฉ
          </button>
        </div>
        <p id="ayah-why" class="hidden"></p>
      </section>

      <!-- Niyyah (Intention) -->
      <section class="card">
        <h3>๐ฒ ููุฉ ุงูููู</h3>
        <p class="text-muted" style="font-size: 0.9rem; margin-bottom: 1rem">
          "ุฅููุง ุงูุฃุนูุงู ุจุงูููุงุช"
        </p>
        <textarea
          id="intention-input"
          class="form-input"
          rows="2"
          placeholder="ุงูุชุจ ููุชู ููุฐุง ุงูููู... (ูุซูุงู: ุฅุทุนุงู ูุณูููุ ุตูุฉ ุฑุญู)"
        ></textarea>
        <button
          class="btn btn-primary mt-4"
          style="width: 100%"
          onclick="saveIntention()"
        >
          ุญูุธ ุงูููุฉ
        </button>
      </section>

      <!-- Emotion Dua -->
      <section class="card">
        <h3>๐คฒ ุฏุนุงุก ุญุณุจ ุญุงูุชู</h3>
        <p class="mb-4 text-muted">ููู ุชุดุนุฑ ุงูุขูุ</p>
        <div class="feeling-grid">
          <div class="feeling-btn" onclick="showDua('sad')">ุถูู / ุญุฒู</div>
          <div class="feeling-btn" onclick="showDua('forgive')">ุทูุจ ูุบูุฑุฉ</div>
          <div class="feeling-btn" onclick="showDua('grateful')">
            ุงูุชูุงู / ุดูุฑ
          </div>
          <div class="feeling-btn" onclick="showDua('anxious')">ููู / ุฎูู</div>
        </div>
        <div
          id="dua-display"
          class="mt-4 hidden p-4 bg-slate-50 border rounded text-center quran-text"
          style="
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
          "
        >
          <!-- Dua will appear here -->
        </div>
      </section>

      <!-- Daily Dhikr -->
      <section class="card text-center">
        <h3>๐ฟ ุฐูุฑ ุงูููู</h3>
        <h2
          class="quran-text mt-4 mb-4"
          id="dhikr-text"
          style="color: var(--color-primary); font-size: 1.8rem"
        >
          ุณุจุญุงู ุงููู ูุจุญูุฏู
        </h2>
        <button class="btn btn-secondary" onclick="randomDhikr()">
          ุฐูุฑ ุขุฎุฑ
        </button>
      </section>

      <div style="height: 100px"></div>
      <!-- Spacer -->
    </main>

    <!-- Navigation -->
    <nav class="nav-bottom">
      <a href="index.html" class="nav-item active">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"
          />
        </svg>
        <span>ุงูุฑุฆูุณูุฉ</span>
      </a>
      <a href="quran_audio.html" class="nav-item">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z" />
        </svg>
        <span>ุชูุงูุงุช</span>
      </a>
      <a href="wird.html" class="nav-item">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"
          />
        </svg>
        <span>ุงููุฑุฏ</span>
      </a>
      <a href="hadith.html" class="nav-item">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"
          />
        </svg>
        <span>ุญุฏูุซ</span>
      </a>
      <a href="stories.html" class="nav-item">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
        </svg>
        <span>ูุตุต</span>
      </a>
      <a href="qa.html" class="nav-item">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"
          />
        </svg>
        <span>ูุชุงูู</span>
      </a>
      <a href="zakat.html" class="nav-item">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
        <span>ุฒูุงุฉ</span>
      </a>
    </nav>

    <script src="js/storage.js"></script>
    <script src="js/prayers.js"></script>
    <script src="js/main.js"></script>
    <script src="js/main.js"></script>
    <script>
      // Test Notification Button Logic
      document.getElementById('notify-test-btn').addEventListener('click', () => {
          if (Notification.permission === 'granted') {
              App.sendNotification("ุงุฎุชุจุงุฑ ุงูุชูุจููุงุช", "ูุธุงู ุงูุชูุจููุงุช ูุนูู ุจูุฌุงุญ!");
          } else if (Notification.permission !== 'denied') {
              Notification.requestPermission().then(permission => {
                  if (permission === 'granted') {
                      App.sendNotification("ุชู ุงูุชูุนูู", "ุดูุฑุงู ูุชูุนูู ุงูุชูุจููุงุช.");
                  }
              });
          } else {
              alert("ุงูุชูุจููุงุช ูุญุธูุฑุฉ. ูุฑุฌู ุชูุนูููุง ูู ุฅุนุฏุงุฏุงุช ุงููุชุตูุญ.");
          }
      });

      // Register Service Worker for PWA
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then((registration) => {
              console.log('Service Worker registered:', registration);
            })
            .catch((error) => {
              console.log('Service Worker registration failed:', error);
            });
        });
      }
      
      // Page Specific Logic
      document.addEventListener("DOMContentLoaded", async () => {
        // Load Ayah
        await App.loadDailyAyah();

        // Load Intention
        const savedIntention = Storage.getIntention();
        if (savedIntention) {
          document.getElementById("intention-input").value = savedIntention;
        }

        // Init Dhikr
        randomDhikr();
      });

      function saveIntention() {
        const val = document.getElementById("intention-input").value;
        Storage.setIntention(val);
        App.showNotification("ุชู ุญูุธ ุงูููุฉุ ุชูุจู ุงููู ููู.");
      }

      async function showDua(feeling) {
        const display = document.getElementById("dua-display");
        display.innerHTML = "ุฌุงุฑู ุงูุจุญุซ...";
        display.classList.remove("hidden");

        // Reset active buttons
        document
          .querySelectorAll(".feeling-btn")
          .forEach((b) => b.classList.remove("active"));
        event.target.classList.add("active");

        const duas = await App.fetchData("duas.json");
        const filtered = duas.filter((d) => d.feeling === feeling);

        if (filtered.length > 0) {
          const random = filtered[Math.floor(Math.random() * filtered.length)];
          display.innerHTML = `
                    <p class="mb-4">${random.text}</p>
                    <button class="btn btn-secondary btn-sm" style="font-size: 0.8rem; padding: 0.3rem 1rem;" onclick="copyText('${random.text}')">ูุณุฎ ุงูุฏุนุงุก</button>
                `;
        } else {
          display.textContent = "ูุง ููุฌุฏ ุฏุนุงุก ูุชุงุญ ุญุงููุงู.";
        }
      }

      const dhikrs = [
        "ุณุจุญุงู ุงููู ูุจุญูุฏู",
        "ุฃุณุชุบูุฑ ุงููู ุงูุนุธูู ูุฃุชูุจ ุฅููู",
        "ูุง ุญูู ููุง ููุฉ ุฅูุง ุจุงููู",
        "ุงูููู ุตู ูุณูู ุนูู ูุจููุง ูุญูุฏ",
        "ูุง ุฅูู ุฅูุง ุงููู ูุญุฏู ูุง ุดุฑูู ูู",
        "ุณุจุญุงู ุงููู ุงูุนุธูู",
      ];

      function randomDhikr() {
        const random = dhikrs[Math.floor(Math.random() * dhikrs.length)];
        document.getElementById("dhikr-text").textContent = random;
      }

      function copyAyah() {
        const text = document.getElementById("ayah-text").textContent;
        const meta = document.getElementById("ayah-meta").textContent;
        copyText(`${text} \n[${meta}]`);
      }

      function copyText(text) {
        navigator.clipboard.writeText(text).then(() => App.showNotification("ุชู ุงููุณุฎ"));
      }
    </script>
  </body>
</html>
